(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+6yh":function(t,e,i){"use strict";i.r(e);var n=i("+c24"),o=i("kzqf");for(var s in o)"default"!==s&&function(t){i.d(e,t,function(){return o[t]})}(s);i("ZkIG");var r=i("KHd+"),a=Object(r.a)(o.default,n.a,n.b,!1,null,null,null);a.options.__file="src/components/board/RoutingModal.vue",e.default=a.exports},"+c24":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-modal",t._b({ref:"bModal"},"b-modal",t.$props,!1),[i("b-input-group",{staticClass:"mb-3",attrs:{prepend:"Source",size:"sm"}},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.routesBridge.source,expression:"routesBridge.source"}],staticClass:"custom-select",on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.routesBridge,"source",e.target.multiple?i:i[0])}}},[i("option",{attrs:{disabled:""},domProps:{value:null}},[t._v("Select a widget…")]),t._v(" "),t._l(t.availableSources,function(e){return i("option",{domProps:{value:e.value}},[t._v(t._s(e.text))])})],2)]),t._v(" "),i("b-table",{ref:"table",attrs:{fields:t.tableData.fields,items:t.tableProvider,responsive:t.responsiveTable,hover:"",striped:""},scopedSlots:t._u([{key:"source",fn:function(e){return[i("b-link",{staticClass:"delete-route-button mr-1",on:{click:function(i){return t.deleteRoute([e.item.source.uid])}}},[i("font-awesome-icon",{attrs:{icon:["fas","times"]}})],1),t._v(" "),i("code",[t._v(t._s(e.item.source.text))])]}},{key:"destinations",fn:function(e){return[i("b-list-group",{staticClass:"mb-2"},t._l(e.item.destinations,function(n,o){return i("b-list-group-item",{key:o},[i("code",[t._v(t._s(n.text))]),t._v(" "),i("b-link",{staticClass:"delete-route-button float-right",on:{click:function(i){return t.deleteRoute([e.item.source.uid,n.uid])}}},[i("font-awesome-icon",{attrs:{icon:["fas","times"]}})],1)],1)}),1),t._v(" "),i("b-input-group",{attrs:{prepend:"Destination",size:"sm"}},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.routesBridge.destinations[e.item.source.uid],expression:"routesBridge.destinations[row.item.source.uid]"}],staticClass:"custom-select",on:{change:function(i){var n=Array.prototype.filter.call(i.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.routesBridge.destinations,e.item.source.uid,i.target.multiple?n:n[0])}}},[i("option",{attrs:{disabled:""},domProps:{value:null}},[t._v("Select a widget…")]),t._v(" "),t._l(t.availableDestinations(e.item.source.uid),function(e){return i("option",{domProps:{value:e.value}},[t._v(t._s(e.text))])})],2)])]}}])},[i("template",{slot:"HEAD_source"},[t._v("\n            Source "),i("font-awesome-icon",{attrs:{icon:["fas","arrow-alt-circle-right"]}})],1),t._v(" "),i("template",{slot:"HEAD_destinations"},[i("font-awesome-icon",{attrs:{icon:["fas","arrow-alt-circle-right"]}}),t._v(" Destinations\n        ")],1)],2)],1)},o=[];n._withStripped=!0,i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},"047U":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isOkToRun?i("b-card",{staticClass:"shadow",class:{special:"ctl"===t.special},attrs:{"no-body":""},on:{click:function(e){t.showOptions=!1}}},[t.loading?i("b-spinner",{staticClass:"loading-spinner",attrs:{label:"Loading…",variant:"danger"}}):t._e(),t._v(" "),i("div",{staticClass:"iframe-box"},[i("iframe",{ref:"iframe",attrs:{id:"frame-"+t.info.widget_uid,name:t.info.widget_uid,sandbox:"ctl"!==t.special&&t.sandbox},on:{load:t.iframeLoaded}})]),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("span",[i("span",[t._v(t._s(t.info.name))])]),t._v(" "),i("span",{staticClass:"float-right"},[i("span",{staticClass:"mr-1",staticStyle:{"font-size":"0.8rem",opacity:"0.6"}},[t._v(t._s(t.info.widget_uid))]),t._v(" "),i("span",{staticClass:"mr-1",staticStyle:{cursor:"pointer"},attrs:{id:t.info.widget_uid+"-options-button"},on:{click:function(e){t.showOptions=!t.showOptions}}},[i("font-awesome-icon",{attrs:{icon:["fas","bars"]}})],1),t._v(" "),i("span",{attrs:{id:t.info.widget_uid+"-handle"}},[i("font-awesome-icon",{attrs:{icon:["fas","arrows-alt"]}})],1)]),t._v(" "),i("div",{staticClass:"data-lights-container position-absolute"},[i("div",{ref:"inputLight",staticClass:"light",class:{invisible:!t.lights.input.on},staticStyle:{"background-color":"aquamarine"}}),t._v(" "),i("div",{ref:"outputLight",staticClass:"light",class:{invisible:!t.lights.output.on},staticStyle:{"background-color":"orange"}})])]),t._v(" "),i("b-popover",{attrs:{container:"viewContainer",target:t.info.widget_uid+"-options-button",placement:"auto"}},[i("b-list-group",[i("b-list-group-item",{attrs:{href:"/s/view/"+t.info.script_uid,target:"_blank",variant:"info"}},[t._v("Reference")]),t._v(" "),t.tryMode||t.special?t._e():i("b-list-group-item",{attrs:{id:"storage-"+t.info.widget_uid+"-button",button:"",variant:"info"}},[t._v("Storage…")]),t._v(" "),t.special?t._e():i("b-list-group-item",{attrs:{id:"delete-"+t.info.widget_uid+"-button",button:"",variant:"danger"}},[t._v("Delete…")])],1)],1),t._v(" "),t.tryMode||t.special?t._e():i("b-popover",{attrs:{container:"viewContainer",target:"storage-"+t.info.widget_uid+"-button",placement:"auto"}},[i("b-list-group",[i("b-list-group-item",{attrs:{active:!t.info.config.sP,disabled:!t.info.config.sP,button:"",variant:"info"},on:{click:function(e){return t.setSP(null)}}},[t._v("Default")]),t._v(" "),t._l(t.availableStorages,function(e,n){return i("b-list-group-item",{key:n,attrs:{active:n===t.info.config.sP,disabled:n===t.info.config.sP,button:"",variant:"info"},on:{click:function(e){return t.setSP(n)}}},[t._v(t._s(e.name))])})],2)],1),t._v(" "),t.special?t._e():i("b-popover",{attrs:{container:"viewContainer",target:"delete-"+t.info.widget_uid+"-button",placement:"auto"}},[i("p",[t._v("Delete "),i("code",[t._v(t._s(t.info.name)+" @ "+t._s(t.info.widget_uid))]),t._v("?\n            You will lose eventual saved data.")]),t._v(" "),i("b-button",{attrs:{variant:"danger"},on:{click:function(e){return t.deleteWidget(t.info.widget_uid)}}},[t._v("Yes")])],1)],1):i("b-card",{staticClass:"text-center shadow",attrs:{"bg-variant":"light","text-variant":"danger"}},[i("h4",[t._v("• "+t._s(t.info.name)+" •")]),t._v(" "),i("b-button",{attrs:{to:"/s/view/"+t.info.script_uid,target:"_blank",size:"sm",variant:"outline-info"}},[t._v("Reference")]),t._v(" "),i("b-button",{attrs:{size:"sm",variant:"outline-danger"},on:{click:t.confirmRun}},[t._v("Run it")]),t._v(" "),i("p",[t._v("This script needs potentially dangerous permissions. Please read its reference page and make sure it doesn't contain harmful code before run it.")])],1)},o=[];n._withStripped=!0,i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},"12rN":function(t,e,i){},"3Byw":function(t,e,i){"use strict";var n=i("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i("e+jF")),s=n(i("kCP0")),r={name:"BoardGrid",components:{GridLayout:o.default.GridLayout,GridItem:o.default.GridItem,Widget:s.default},props:{widgets:Array,bus:Object,tryMode:{type:Boolean,default:!1}},data:function(){return{layoutBridge:null,widgetsBridge:null}},computed:{},methods:{wInfoUpdated:function(){this.$emit("update:widgets",this.widgetsBridge)}},watch:{widgets:{handler:function(t){this.widgetsBridge=t,this.layoutBridge=JSON.parse(JSON.stringify(t.map(function(t){return t.layout})))},deep:!0}}};e.default=r},"3T4Y":function(t,e,i){"use strict";var n=i("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("Z2Ku"),i("L9s1"),i("dRSK"),i("rE2o"),i("ioFf"),i("rGqo");var o=n(i("LvDl")),s=n(i("YA6A")),r=n(i("Pvcx")),a=n(i("BXnY")),u=n(i("HUCe")),d=n(i("cCyB")),c=n(i("VXIQ")),l=n(i("ojIa")),f=n(i("wGQC")),h=n(i("f30V")),g={name:"RoutingModal",extends:l.default,components:{BModal:l.default,BFormInput:h.default,BLink:f.default,BFormSelect:c.default,BListGroupItem:d.default,BListGroup:u.default,BInputGroupText:a.default,BInputGroup:r.default,BTable:s.default},props:{widgets:Array,routes:Array},data:function(){return{tableData:{fields:["source","destinations"]}}},computed:{responsiveTable:function(){return!/(?=.*iPad|iPhone|iPod)(?=.*WebKit)/.test(window.navigator.userAgent)},availableSources:function(){var t=this,e=[],i=!0,n=!1,o=void 0;try{for(var s,r=function(){var i=s.value;t.routes.find(function(t){return t.source===i.info.widget_uid})||e.push({value:i.info.widget_uid,text:"".concat(i.info.name," @ ").concat(i.info.widget_uid)})},a=this.widgets[Symbol.iterator]();!(i=(s=a.next()).done);i=!0)r()}catch(t){n=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}return e},routesBridge:function(){var t=this,e={destinations:{}};Object.defineProperty(e,"source",{get:function(){return null},set:function(e){t.addSource(e)}});var i=!0,n=!1,o=void 0;try{for(var s,r=function(){var i=s.value;Object.defineProperty(e.destinations,i.source,{get:function(){return null},set:function(e){t.addDestination(i.source,e)}})},a=this.routes[Symbol.iterator]();!(i=(s=a.next()).done);i=!0)r()}catch(t){n=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw o}}return e}},methods:{show:function(){this.$refs.bModal.show()},hide:function(){this.$refs.bModal.show()},availableDestinations:function(t){var e=[],i=!0,n=!1,s=void 0;try{for(var r,a=this.widgets[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var u=r.value,d=this.routes.find(function(e){return e.source===t});d&&!d.destinations.includes(u.info.widget_uid)&&(e=o.default.concat(e,{value:u.info.widget_uid,text:"".concat(u.info.name," @ ").concat(u.info.widget_uid)}))}}catch(t){n=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw s}}return e},tableProvider:function(){var t=[],e=this,i=!0,n=!1,s=void 0;try{for(var r,a=function(){var i=r.value,n=e.widgets.find(function(t){return t.info.widget_uid===i.source}).info.name,s=o.default.map(i.destinations,function(t){return{uid:t,text:e.widgets.find(function(e){return e.info.widget_uid===t}).info.name+" @ "+t}});t.push({source:{uid:i.source,text:"".concat(n," @ ").concat(i.source)},destinations:s})},u=this.routes[Symbol.iterator]();!(i=(r=u.next()).done);i=!0)a()}catch(t){n=!0,s=t}finally{try{i||null==u.return||u.return()}finally{if(n)throw s}}return t},deleteRoute:function(t){if(1===t.length)this.$emit("update:routes",this.routes.filter(function(e){return e.source!==t[0]}));else if(2===t.length){var e=o.default.clone(this.routes),i=e.find(function(e){return e.source===t[0]}),n=e.indexOf(i);i.destinations=o.default.pull(i.destinations,t[1]),e[n]=i,this.$emit("update:routes",e)}},addSource:function(t){"string"==typeof t&&t.length&&this.$emit("update:routes",this.routes.concat({source:t,destinations:[]}))},addDestination:function(t,e){if("string"==typeof t&&t.length&&"string"==typeof e&&e.length){var i=o.default.clone(this.routes),n=i.find(function(e){return e.source===t}),s=i.indexOf(n);n.destinations=n.destinations.concat(e),i[s]=n,this.$emit("update:routes",i)}}},watch:{routes:function(){this.$refs.table&&this.$refs.table.refresh()}}};e.default=g},AY9r:function(t,e,i){},Al3V:function(t,e,i){"use strict";i.r(e);var n=i("L+Tr"),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e.default=o.a},"L+Tr":function(t,e,i){"use strict";var n=i("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i("LvDl")),s=n(i("t1te")),r=n(i("LyxP")),a=n(i("iRE3")),u=n(i("HUCe")),d=n(i("cCyB")),c=n(i("27Yb")),l=n(i("ZuJt")),f=i("X7BR"),h={name:"Widget",components:{BButton:l.default,BCard:c.default,BListGroupItem:d.default,BListGroup:u.default,BPopover:a.default,BSpinner:r.default},props:{info:Object,bus:Object,tryMode:{type:Boolean,default:!1}},data:function(){return{runDangerous:!1,channel:null,lights:{input:{on:!1,debounceOff:null},output:{on:!1,debounceOff:null}},loading:!1,showOptions:!1}},computed:{special:function(){return this.info.script_uid===f.BOARD_CTL_SCRIPT_UID&&"ctl"},sandbox:function(){var t="";for(var e in this.info.sandbox)t+=this.info.sandbox[e]?f.SANDBOX_TOKENS[e]+" ":"";return t},dangerous:function(){for(var t in this.info.sandbox)if(t>4&&this.info.sandbox[t])return!0;return!1},isOkToRun:function(){return!this.dangerous||this.info.runDangerous||this.runDangerous||!0===this.info.config.okToRun},availableStorages:function(){return this.$store.getters["storageProviders/available"]}},methods:{confirmRun:function(){this.runDangerous=!0,this.getHtml(),!/^w/.exec(this.info.widget_uid)||this.tryMode||this.info.config.okToRun||(this.info.config.okToRun=!0,this.$root.$emit("saveWidgetsConfigs",[this.info.widget_uid]))},getHtml:function(){this.loading=!0;var t=this;s.default.getHtml({uid:this.info.script_uid,type:"code"}).then(function(e){t.$refs.iframe.src=URL.createObjectURL(new Blob([e],{type:"text/html"}))}).catch(function(e){t.$refs.iframe.src=URL.createObjectURL(new Blob([JSON.stringify(e)],{type:"text/html"}))})},iframeLoaded:function(){window.URL.revokeObjectURL(this.$refs.iframe.src),this.channel=new MessageChannel,this.channel.port1.onmessage=this.messageFromFrame,this.$refs.iframe.contentWindow.postMessage({type:"initPort"},"*",[this.channel.port2]),this.bus.$off(">".concat(this.info.widget_uid)),this.bus.$on(">".concat(this.info.widget_uid),this.messageToFrame),this.loading=!1},messageFromFrame:function(t){var e=this;switch(t.data.type){case"output":this.bus.$emit("widgetOutput",{source:{script:this.info.script_uid,widget:this.info.widget_uid},content:t.data.content});break;case"fetchStorage":if(!/^w/.exec(this.info.widget_uid)||this.tryMode)break;var i=this.info.config.sP||this.$store.getters["auth/defaultSP"];this.availableStorages[i]&&this.$store.dispatch("storageProviders/fetchStorage",{wInfo:this.info}).then(function(t){var i={code:3e3,data:t};e.$refs.iframe.contentWindow.postMessage({type:"storage",content:i},"*")}).catch(function(t){console.warn(t);var i={code:4e3,error:JSON.parse(JSON.stringify(t))};e.$refs.iframe.contentWindow.postMessage({type:"storage",content:i},"*")});break;case"saveStorage":if(!/^w/.exec(this.info.widget_uid)||this.tryMode)break;o.default.isEmpty(this.availableStorages)?this.$notify({group:"main",title:"It seems you have not set up a storage provider yet.",text:"You can fix this in your settings.",type:"warn",duration:1e4}):this.$store.dispatch("storageProviders/saveStorage",{wInfo:this.info,data:t.data.content})}this.lights.output.on=!0,this.lights.output.debounceOff()},messageToFrame:function(t){var e=t.source,i=t.content,n=void 0===i?null:i;this.channel.port1.postMessage({source:e,content:n}),this.lights.input.on=!0,this.lights.input.debounceOff()},setSP:function(t){this.$set(this.info.config,"sP",t),this.$emit("update:info",this.info),this.$root.$emit("saveWidgetsConfigs",[this.info.widget_uid])},deleteWidget:function(t){var e=this;this.showOptions=!1,/^w/.exec(this.info.widget_uid)&&!this.tryMode?this.$store.dispatch("storageProviders/deleteWidgetStore",this.info).catch(function(t){console.warn(t)}).then(function(){e.$root.$emit("deleteWidget",t)}):this.$root.$emit("deleteWidget",t)}},created:function(){o.default.forIn(this.lights,function(t){t.debounceOff=o.default.debounce(function(){t.on=!1},150)})},mounted:function(){this.isOkToRun&&this.getHtml()},beforeDestroy:function(){this.bus.$off(">".concat(this.info.widget_uid))}};e.default=h},ZeZY:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.widgetsBridge&&t.layoutBridge?i("div",[i("grid-layout",{attrs:{layout:t.layoutBridge,"col-num":12,"row-height":60,"is-draggable":!0,"is-resizable":!0,"is-mirrored":!1,"vertical-compact":!0,margin:[5,5],"use-css-transforms":!0,responsive:!0,breakpoints:{lg:1440,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:8,sm:6,xs:4,xxs:2}},on:{"update:layout":function(e){t.layoutBridge=e},"layout-updated":function(e){return t.$emit("layout-updated",e)}}},t._l(t.layoutBridge,function(e){return i("grid-item",{key:e.i,attrs:{id:e.i+"-grid-item",x:e.x,y:e.y,w:e.w,h:e.h,i:e.i,dragAllowFrom:"#"+e.i+"-handle"}},[i("Widget",{attrs:{info:t.widgetsBridge.find(function(t){return t.info.widget_uid===e.i}).info,bus:t.bus,tryMode:t.tryMode},on:{"update:info":[function(i){t.$set(t.widgetsBridge.find(function(t){return t.info.widget_uid===e.i}),"info",i)},t.wInfoUpdated]}})],1)}),1)],1):t._e()},o=[];n._withStripped=!0,i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},ZkIG:function(t,e,i){"use strict";var n=i("AY9r");i.n(n).a},a7kz:function(t,e,i){"use strict";var n=i("12rN");i.n(n).a},"bh+v":function(t,e,i){"use strict";var n=i("tviw");i.n(n).a},by4G:function(t,e,i){"use strict";var n=i("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("rE2o"),i("ioFf"),i("rGqo"),i("dRSK"),i("Z2Ku"),i("L9s1");var o=n(i("LvDl")),s=n(i("oCYn")),r=n(i("gr/6")),a=n(i("t1te")),u=i("X7BR"),d=n(i("eBXC")),c=n(i("+6yh"));function l(t,e){var i=e.map(function(t){return t.info.widget_uid});return t.reduce(function(t,e){return o.default.includes(i,e.source)&&t.push({source:e.source,destinations:e.destinations.filter(function(t){return o.default.includes(i,t)})}),t},[])}var f={name:"Board",components:{BoardGrid:r.default,AddWidgetModal:d.default,RoutingModal:c.default},props:{mode:String,uid:String,testWidget:{type:String,default:null}},data:function(){return{info:null,widgets:[],routes:[],bus:new s.default}},computed:{own:function(){return!!this.info&&this.info.user.username===this.$store.getters["auth/username"]}},methods:{setWidgets:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t;i||(n=n.filter(function(t){return!e.widgets.find(function(e){return e.info.widget_uid===t.info.widget_uid})}));var s=n.map(function(t){return o.default.isEmpty(t.layout)&&(t.layout=o.default.assign(o.default.clone(t.info.dimensions),{x:0,y:0})),t.layout.i=t.info.widget_uid,t});this.widgets=i?s:this.widgets.concat(s)},fetchTestWidget:function(t){var e=this;a.default.getTestWidget(t).then(function(t){e.setWidgets([t.widget],!1)}).catch(function(i){e.$notify({group:"main",title:"Could not fetch `".concat(t,"`."),text:i.data.message||i.data.code||"Unknown error.",type:"warn",duration:4e3})})},fetchWidgets:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this;a.default.boardWidgets(t).then(function(o){document.title=o.board.name+" - "+n.$store.getters.appTitle,/\/run\//.exec(n.$route.path)&&o.board.user.username!==n.$store.getters["auth/username"]?e.$router.push("/b/try/".concat(t)):(n.info=o.board,n.routes=l(o.board.config.routes||[],o.widgets),n.setWidgets(o.widgets,i))}).catch(function(){e.$router.push("/")})},saveEdit:function(){a.default.saveBoardEdit({Info:this.info})},reload:function(){this.testWidget?this.fetchTestWidget(this.testWidget):this.uid&&this.fetchWidgets(this.uid)},layoutUpdated:function(t){this.testWidget?this.$emit("layout-updated",t):this.uid&&"run"===this.mode&&a.default.saveBoardEdit({Info:{uid:this.info.uid},WidgetsData:t.map(function(t){return{uid:t.i,layout:o.default.pick(t,["x","y","w","h"])}})})},outputFromWidget:function(t){var e=t.source,i=t.content,n=void 0===i?null:i;if(e.script===u.BOARD_CTL_SCRIPT_UID)switch(n.action){case"getInfo":var s=o.default.assign(o.default.pickBy(this.info,function(t,e){return o.default.includes(["name","description","user"],e)}),{own:this.own});this.bus.$emit(">".concat(e.widget),{source:"root",content:s});break;case"setInfo":this.info=o.default.assign({uid:this.info.uid},n.data),document.title=this.info.name+" - "+this.$store.getters.appTitle,this.saveEdit();break;case"openAddWidget":this.openAddWidget();break;case"openRouting":this.openRouting()}else this.doRouting({source:e,content:n})},doRouting:function(t){var e=t.source,i=t.content,n=!0,o=!1,s=void 0;try{for(var r,a=this.routes.filter(function(t){return t.source===e.widget})[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var u=r.value,d=!0,c=!1,l=void 0;try{for(var f,h=u.destinations[Symbol.iterator]();!(d=(f=h.next()).done);d=!0){var g=f.value;this.bus.$emit(">".concat(g),{source:e,content:i})}}catch(t){c=!0,l=t}finally{try{d||null==h.return||h.return()}finally{if(c)throw l}}}}catch(t){o=!0,s=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw s}}},openAddWidget:function(){this.$refs.addWidgetModal.show()},openRouting:function(){this.$refs.routingModal.show()},addWidget:function(t){var e=this;switch(this.$refs.addWidgetModal.hide(),this.mode){case"try":this.fetchTestWidget(t);break;case"run":var i=this;a.default.saveBoardEdit({Info:{uid:this.info.uid},Add:[t]}).then(function(){e.fetchWidgets(i.info.uid,!1)})}},deleteWidget:function(t){switch(this.widgets=o.default.clone(this.widgets).filter(function(e){return e.info.widget_uid!==t}),this.routes=l(this.routes,this.widgets),this.mode){case"run":a.default.saveBoardEdit({Info:{uid:this.info.uid,config:{routes:this.routes}},Delete:[t]})}},saveRoutes:function(){switch(this.mode){case"run":this.debouncedSaveRoutes()}},saveConfigs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];switch(this.mode){case"run":a.default.saveBoardEdit({Info:{uid:this.info.uid},WidgetsData:this.widgets.filter(function(e){return o.default.isEmpty(t)||o.default.includes(t,e.info.widget_uid)}).map(function(t){return{uid:t.info.widget_uid,config:t.info.config}})})}}},watch:{$route:function(t,e){this.reload()}},created:function(){var t=this;this.debouncedSaveRoutes=o.default.debounce(function(){a.default.saveBoardEdit({Info:{uid:t.info.uid,config:{routes:l(t.routes,t.widgets)}}})},4e3)},mounted:function(){this.reload(),this.bus.$on("widgetOutput",this.outputFromWidget),this.$root.$on("deleteWidget",this.deleteWidget),this.$root.$on("saveWidgetsConfigs",this.saveConfigs)},beforeDestroy:function(){this.bus.$off("widgetOutput"),this.$root.$off("deleteWidget",this.deleteWidget),this.$root.$off("saveWidgetsConfigs",this.saveConfigs)}};e.default=f},eBXC:function(t,e,i){"use strict";i.r(e);var n=i("rdhW"),o=i("uG45");for(var s in o)"default"!==s&&function(t){i.d(e,t,function(){return o[t]})}(s);i("bh+v");var r=i("KHd+"),a=Object(r.a)(o.default,n.a,n.b,!1,null,"1e4ea961",null);a.options.__file="src/components/board/AddWidgetModal.vue",e.default=a.exports},"gr/6":function(t,e,i){"use strict";i.r(e);var n=i("ZeZY"),o=i("vzmA");for(var s in o)"default"!==s&&function(t){i.d(e,t,function(){return o[t]})}(s);var r=i("KHd+"),a=Object(r.a)(o.default,n.a,n.b,!1,null,null,null);a.options.__file="src/components/board/BoardGrid.vue",e.default=a.exports},juSy:function(t,e,i){"use strict";i.r(e);var n=i("by4G"),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e.default=o.a},kCP0:function(t,e,i){"use strict";i.r(e);var n=i("047U"),o=i("Al3V");for(var s in o)"default"!==s&&function(t){i.d(e,t,function(){return o[t]})}(s);i("a7kz");var r=i("KHd+"),a=Object(r.a)(o.default,n.a,n.b,!1,null,"4ca18318",null);a.options.__file="src/components/Widget.vue",e.default=a.exports},kaZa:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("BoardGrid",{attrs:{widgets:t.widgets,bus:t.bus,tryMode:!!t.testWidget||"try"===t.mode},on:{"update:widgets":function(e){t.widgets=e},"layout-updated":t.layoutUpdated}}),t._v(" "),i("AddWidgetModal",{ref:"addWidgetModal",attrs:{title:"Add widget",lazy:"","hide-footer":"",size:"lg",scrollable:""},on:{addWidget:t.addWidget}}),t._v(" "),i("RoutingModal",{ref:"routingModal",attrs:{widgets:t.widgets,routes:t.routes,title:"Routes",lazy:"","hide-footer":"",size:"lg",scrollable:""},on:{"update:routes":[function(e){t.routes=e},t.saveRoutes]}})],1)},o=[];n._withStripped=!0,i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},kzqf:function(t,e,i){"use strict";i.r(e);var n=i("3T4Y"),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e.default=o.a},nsXE:function(t,e,i){"use strict";var n=i("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("OG14"),i("VRzm"),i("Btvt"),i("CX2u");var o=n(i("LvDl")),s=n(i("YA6A")),r=n(i("Pvcx")),a=n(i("BXnY")),u=n(i("HUCe")),d=n(i("cCyB")),c=n(i("VXIQ")),l=n(i("ojIa")),f=n(i("wGQC")),h=n(i("f30V")),g=n(i("LyxP")),v=n(i("t1te")),p=i("X7BR"),m={name:"AddWidgetModal",extends:l.default,components:{BSpinner:g.default,BModal:l.default,BFormInput:h.default,BLink:f.default,BFormSelect:c.default,BListGroupItem:d.default,BListGroup:u.default,BInputGroupText:a.default,BInputGroup:r.default,BTable:s.default},props:{widgets:Array,routes:Array},data:function(){return{searchString:"",searchResults:[],page:1,endOfResults:!1,resultsPerPage:20,loading:!1,fields:["name",{key:"user",label:"By"}]}},computed:{emptyTableString:function(){return p.EMPTY_RESULTS_STRING},responsiveTable:function(){return!/(?=.*iPad|iPhone|iPod)(?=.*WebKit)/.test(window.navigator.userAgent)}},methods:{show:function(){this.$refs.bModal.show(),this.$nextTick(function(){document.getElementById("addWidgetModal___BV_modal_body_").addEventListener("scroll",this.onScroll)})},hide:function(){document.getElementById("addWidgetModal___BV_modal_body_").removeEventListener("scroll",this.onScroll),this.$refs.bModal.show()},bModalShown:function(){this.$refs.searchInput.focus(),this.throttledFetch()},fetchResults:function(){var t=this;this.loading=!0,v.default.search({searchString:this.searchString,categories:["scripts"],page:this.page}).then(function(e){var i=e.results.scripts||[];t.searchResults=t.searchResults.concat(i),t.page++,e.results.scripts.length<t.resultsPerPage&&(t.endOfResults=!0)}).catch(function(){t.searchResults=[],t.page=1,t.endOfResults=!1}).finally(function(){t.loading=!1,t.$refs.table&&t.$refs.table.refresh(),t.$nextTick(function(){window.innerHeight>document.getElementById("addWidgetModal___BV_modal_body_").scrollHeight&&this.onScroll()})})},search:function(){this.searchResults=[],this.page=1,this.endOfResults=!1,this.debouncedSearch()},onScroll:function(){if(this.searchResults.length&&!this.loading&&!this.endOfResults){var t=document.getElementById("addWidgetModal___BV_modal_body_");(t.scrollTop+window.innerHeight>t.scrollHeight||window.innerHeight>t.scrollHeight)&&this.throttledFetch()}},addWidget:function(t){this.$emit("addWidget",t.uid)}},created:function(){this.throttledFetch=o.default.throttle(this.fetchResults,1e3),this.debouncedSearch=o.default.debounce(this.fetchResults,500)}};e.default=m},rdhW:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-modal",t._b({ref:"bModal",attrs:{id:"addWidgetModal"},on:{shown:t.bModalShown}},"b-modal",t.$props,!1),[i("b-input-group",{staticClass:"mb-2"},[i("b-input-group-text",{attrs:{slot:"prepend"},slot:"prepend"},[i("font-awesome-icon",{attrs:{icon:["fas","search"]}})],1),t._v(" "),i("b-form-input",{ref:"searchInput",attrs:{type:"search",placeholder:"Search…"},on:{input:t.search,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.target.blur()}},model:{value:t.searchString,callback:function(e){t.searchString=e},expression:"searchString"}})],1),t._v(" "),i("b-table",{ref:"table",attrs:{fields:t.fields,items:t.searchResults,responsive:t.responsiveTable,"show-empty":"",hover:""},on:{"row-clicked":t.addWidget},scopedSlots:t._u([{key:"name",fn:function(e){return[t._v("\n            "+t._s(e.item.name)+"\n        ")]}},{key:"user",fn:function(e){return[i("b-link",{attrs:{to:"/u/profile/"+e.item.user.username}},[t._v(t._s(e.item.user.username))])]}}])},[t._v(" "),t._v(" "),i("div",{staticStyle:{"text-align":"center"},attrs:{slot:"empty"},slot:"empty"},[i("em",[t._v(t._s(t.emptyTableString))])]),t._v(" "),i("div",{staticClass:"text-center text-info my-2",attrs:{slot:"table-busy"},slot:"table-busy"},[i("strong",[t._v("Loading…")])])]),t._v(" "),i("div",{staticStyle:{"text-align":"center"}},[t.loading?i("b-spinner",{staticClass:"loading-spinner",attrs:{label:"Loading…",variant:"danger"}}):t._e()],1)],1)},o=[];n._withStripped=!0,i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},talt:function(t,e,i){"use strict";i.r(e);var n=i("kaZa"),o=i("juSy");for(var s in o)"default"!==s&&function(t){i.d(e,t,function(){return o[t]})}(s);var r=i("KHd+"),a=Object(r.a)(o.default,n.a,n.b,!1,null,null,null);a.options.__file="src/components/board/Board.vue",e.default=a.exports},tviw:function(t,e,i){},uG45:function(t,e,i){"use strict";i.r(e);var n=i("nsXE"),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e.default=o.a},vzmA:function(t,e,i){"use strict";i.r(e);var n=i("3Byw"),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e.default=o.a}}]);