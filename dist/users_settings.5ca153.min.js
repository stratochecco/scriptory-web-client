(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"+SnX":function(e,t,r){"use strict";r.r(t);var a=r("knDc"),n=r("sDcr");for(var s in n)"default"!==s&&function(e){r.d(t,e,function(){return n[e]})}(s);var i=r("KHd+"),o=Object(i.a)(n.default,a.a,a.b,!1,null,null,null);o.options.__file="src/components/Flag.vue",t.default=o.exports},"1gsz":function(e,t,r){"use strict";r.r(t);var a=r("ZvP7"),n=r.n(a);for(var s in a)"default"!==s&&function(e){r.d(t,e,function(){return a[e]})}(s);t.default=n.a},"5ZGV":function(e,t,r){"use strict";var a=r("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.props=void 0;var n=a(r("lSNA")),s=a(r("y5Xb")),i=r("tC49"),o=r("F8x6"),u=["start","end","center"],l={tag:{type:String,default:"div"},noGutters:{type:Boolean,default:!1},alignV:{type:String,default:null,validator:function(e){return(0,o.arrayIncludes)(u.concat(["baseline","stretch"]),e)}},alignH:{type:String,default:null,validator:function(e){return(0,o.arrayIncludes)(u.concat(["between","around"]),e)}},alignContent:{type:String,default:null,validator:function(e){return(0,o.arrayIncludes)(u.concat(["between","around","stretch"]),e)}}};t.props=l;var c=s.default.extend({name:"BRow",functional:!0,props:l,render:function(e,t){var r,a=t.props,s=t.data,o=t.children;return e(a.tag,(0,i.mergeData)(s,{staticClass:"row",class:(r={"no-gutters":a.noGutters},(0,n.default)(r,"align-items-".concat(a.alignV),a.alignV),(0,n.default)(r,"justify-content-".concat(a.alignH),a.alignH),(0,n.default)(r,"align-content-".concat(a.alignContent),a.alignContent),r)}),o)}});t.default=c},YeLY:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={name:"Flag",props:{width:String,quarters:Array}};t.default=a},ZvP7:function(e,t,r){"use strict";var a=r("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("CX2u"),r("VRzm"),r("rGqo"),r("yt8O"),r("Btvt"),r("XfO3");var n=a(r("o0o1"));r("ls82");var s=a(r("yXPU")),i=a(r("MVZn")),o=r("L2JU"),u=r("ta7f"),l=a(r("LvDl")),c=a(r("eAHg")),d=a(r("ojIa")),f=a(r("ZuJt")),v=a(r("5ZGV")),p=a(r("GmdH")),m=a(r("27Yb")),h=a(r("YA6A")),b=a(r("wGQC")),w=a(r("7p58")),y=a(r("f30V")),g=a(r("Yp9E")),_=a(r("iAdB")),k=a(r("yRFN")),x=a(r("+SnX")),P=r("8QGd"),$={name:"Users_Settings_View",components:{BFormGroup:_.default,BFormInvalidFeedback:g.default,BFormInput:y.default,BForm:w.default,BLink:b.default,BTable:h.default,BCard:m.default,BCol:p.default,BRow:v.default,BButton:f.default,BModal:d.default,BContainer:c.default,Flag:x.default},data:function(){return{newEmail:"",emailAvailable:!0,currentPassword:"",newPassword:"",loading:!1,keypairsTable:{sortBy:"number",fields:[{key:"number",sortable:!0},{key:"type",sortable:!0,class:"text-center"},{key:"purpose",sortable:!0,class:"text-center"},{key:"valid",sortable:!0,class:"text-center"},{key:"created",class:"text-center"},{key:"pubKey",label:"Pub Key",class:"text-center"},{key:"revCert",label:"Revocation Cert",class:"text-center"},{key:"encPrivKey",label:"Enc Priv Key",class:"text-center"},{key:"salt",label:"Passphrase Salt",class:"text-center"},{key:"options"}]}}},computed:(0,i.default)({},(0,o.mapState)("storageProviders",["dropbox"]),{username:function(){return this.$store.getters["auth/username"]},defaultSP:function(){return this.$store.getters["auth/userConfig"].defaultSP},isDropboxAuthenticated:function(){return!!this.dropbox.accessToken}}),validations:{newEmail:{required:u.required,email:u.email,emailAvailable:function(e){return this.emailAvailable}},currentPassword:{required:u.required,minLength:(0,u.minLength)(3)},newPassword:{required:u.required,minLength:(0,u.minLength)(3)}},methods:(0,i.default)({},(0,o.mapActions)(["fetchKeypairs"]),{keypairsTableItemsProvider:function(){var e=this.$store.state.encKeypairs,t=[];return e&&e.map(function(e){t.push(e)}),t},submitChangeEmail:function(){var e=this;if(this.$v.newEmail.$touch(),this.$v.newEmail.$invalid)return!1;(0,s.default)(n.default.mark(function t(){var r;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,r=e.newEmail,t.prev=2,e.$notify({group:"main",clean:!0}),e.$notify({group:"main",title:"Thank you!",text:"Hang on…",type:"info",duration:-1}),t.next=7,k.default.changeEmail({NewEmail:r});case 7:!0===t.sent.response&&e.$refs.checkMailModal.show(),e.$notify({group:"main",clean:!0}),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(2),e.$notify({group:"main",clean:!0}),e.$notify({group:"main",title:"Something went wrong…",text:t.t0.message+(t.t0.errors?"\n"+JSON.stringify(t.t0.errors):""),type:"error",duration:-1}),console.error(t.t0);case 17:e.loading=!1;case 18:case"end":return t.stop()}},t,null,[[2,12]])}))()},submitChangePassword:function(){var e=this;if(this.$v.newPassword.$touch(),this.$v.newPassword.$invalid)return!1;(0,s.default)(n.default.mark(function t(){var r,a,s,i,o,u,c,d,f,v;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,r=e.currentPassword,a=e.newPassword,e.currentPassword="",e.newPassword="",s=e.$store.getters["auth/username"],t.prev=6,e.$notify({group:"main",title:"Authenticating…",text:null,type:"info",duration:4e3}),t.next=10,e.$store.dispatch("auth/loginInfo",e.$store.getters["auth/username"]);case 10:return i=t.sent,o=i.salt,t.next=14,e.$store.dispatch("auth/getSrp",{loginString:s,password:r,options:{ChangePassword:!0}});case 14:return u=t.sent,e.$notify({group:"main",title:"Generating your new SRP verifier…",text:"",type:"info",duration:4e3}),t.next=18,(0,P.getRandomSrpVerifier)(i.modulus,{username:s,password:a,salt:o});case 18:return c=t.sent,t.next=21,(0,P.computeKeyPassword)(a,c.salt);case 21:return d=t.sent,e.$notify({group:"main",title:"Updating your private keys…",text:"Hang on…",type:"info",duration:4e3}),t.next=25,e.$store.dispatch("fetchKeypairs",{username:s,widgets:[]});case 25:return t.next=27,e.$store.dispatch("decryptKeypairs");case 27:return f=t.sent,v=l.default.cloneDeep(f).map(function(e){return(0,P.computeKeyPassword)(d,e.salt).then(function(t){return(0,P.reformatKey)(e.priv_key,{name:e.priv_key.users[0].userId.name,email:e.priv_key.users[0].userId.email},t)}).then(function(t){return l.default.assign(e,{reformattedPrivKey:t})}).catch(function(e){return console.error(e),e})}),t.next=31,Promise.all(v);case 31:return f=t.sent,t.next=34,k.default.changePassword({ChangePasswordAuth:u.data.Options.PasswordChangeAuth,Verifier:c.verifier,Salt:c.salt,Keypairs:f.map(function(e){return e.reformattedPrivKey?{number:e.number,enc_priv_key:e.reformattedPrivKey}:null})});case 34:if(!0!==t.sent.Response){t.next=39;break}return t.next=38,e.$store.commit("auth/setPasswordHash",d);case 38:e.$notify({group:"main",title:"Password changed",text:null,type:"success",duration:4e3});case 39:t.next=44;break;case 41:t.prev=41,t.t0=t.catch(6),console.error(t.t0);case 44:e.loading=!1;case 45:case"end":return t.stop()}},t,null,[[6,41]])}))()},connect:function(e){this.$store.dispatch("storageProviders/requestAccessUrl",e).then(function(e){window.open(e,"_blank")})},disconnect:function(e){this.$store.dispatch("storageProviders/revokeAccess",e)},makeDefault:function(e){this.$store.dispatch("storageProviders/makeDefault",e)}}),created:function(){var e=this;this.dropbox.authResponse&&this.$store.dispatch("storageProviders/consumeAuthResponse","dropbox"),this.checkEmailAvailable=l.default.debounce(function(){""!==e.newEmail?e.$store.dispatch("auth/emailAvailable",e.newEmail).then(function(t){e.emailAvailable=t.available}).catch(function(t){e.emailAvailable=!0,console.log(t)}):e.emailAvailable=!0},1e3)},mounted:function(){var e=this;document.title="Settings - ".concat(this.username," - ").concat(this.$store.getters.appTitle),this.fetchKeypairs({username:this.username,widgets:[]}).catch(function(t){e.$notify({group:"main",title:"Something went wrong…",text:t,type:"error",duration:4e3}),console.warn(t)}).finally(function(){e.$refs.keypairsTable.refresh()})}};t.default=$},aGq8:function(e,t,r){"use strict";var a=r("g9wJ");r.n(a).a},g9wJ:function(e,t,r){},iNYP:function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",{attrs:{id:"viewContainer"}},[r("h1",[e._v("Settings - "+e._s(e.username))]),e._v(" "),r("b-row",{staticClass:"mb-4"},[r("b-col",[r("b-card",{staticClass:"shadow"},[r("template",{slot:"header"},[r("h5",{staticClass:"m-0"},[e._v("Storage")])]),e._v(" "),r("p",[e._v("\n                    Scriptory doesn't provide cloud storage for your widgets data."),r("br"),e._v("\n                    If you want your data to persist somewhere you must connect an account here below.\n                ")]),e._v(" "),r("hr"),e._v(" "),r("div",[r("h5",[e._v("Dropbox")]),e._v(" "),e.isDropboxAuthenticated?r("b-button",{ref:"disconnectDropboxButton",attrs:{disabled:e.loading,variant:"outline-danger",size:"sm"},on:{click:function(t){return e.disconnect("dropbox")}}},[e._v("Disconnect")]):r("b-button",{ref:"connectDropboxButton",attrs:{disabled:e.loading,variant:"outline-info",size:"sm"},on:{click:function(t){return e.connect("dropbox")}}},[e._v("Connect")]),e._v(" "),r("b-button",{attrs:{disabled:"dropbox"===e.defaultSP||e.loading,variant:"dropbox"===e.defaultSP?"info":"outline-info",size:"sm"},on:{click:function(t){return e.makeDefault("dropbox")}}},[e._v("Default")])],1),e._v(" "),r("hr")],2)],1)],1),e._v(" "),r("b-row",{staticClass:"mb-4"},[r("b-col",[r("b-card",{staticClass:"shadow"},[r("template",{slot:"header"},[r("h5",{staticClass:"m-0"},[e._v("Account")])]),e._v(" "),r("h5",[e._v("Change email")]),e._v(" "),r("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitChangeEmail(t)}}},[r("b-form-group",{attrs:{id:"newEmailFormGroup"}},[r("b-form-input",{staticClass:"mb-2",attrs:{type:"email",state:!e.$v.newEmail.$invalid,size:"sm",required:"",placeholder:"New email",autocomplete:"email"},on:{input:e.checkEmailAvailable},model:{value:e.newEmail,callback:function(t){e.newEmail=t},expression:"newEmail"}}),e._v(" "),e.$v.newEmail.emailAvailable?e._e():r("b-form-invalid-feedback",[e._v("\n                            Already in use. Sorry…\n                        ")])],1),e._v(" "),r("b-button",{attrs:{disabled:e.$v.newEmail.$invalid||e.loading,type:"submit",size:"sm",variant:"primary"}},[e._v("Submit")])],1),e._v(" "),r("hr"),e._v(" "),r("h5",[e._v("Change password")]),e._v(" "),r("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitChangePassword(t)}}},[r("b-form-input",{staticStyle:{display:"none"},attrs:{value:e.username,autocomplete:"username email"}}),e._v(" "),r("b-form-group",{attrs:{id:"currentPasswordFormGroup"}},[r("b-form-input",{staticClass:"mb-2",attrs:{type:"password",state:!e.$v.currentPassword.$invalid,size:"sm",required:"",placeholder:"Current password",autocomplete:"password"},model:{value:e.currentPassword,callback:function(t){e.currentPassword=t},expression:"currentPassword"}})],1),e._v(" "),r("b-form-group",{attrs:{id:"newPasswordFormGroup"}},[r("b-form-input",{staticClass:"mb-2",attrs:{type:"password",state:!e.$v.newPassword.$invalid,size:"sm",required:"",placeholder:"New password",autocomplete:"new-password"},model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}}),e._v(" "),e.$v.newPassword.minLength?e._e():r("b-form-invalid-feedback",[e._v("\n                            Come on! At least 3 characters\n                        ")])],1),e._v(" "),r("b-button",{attrs:{disabled:e.$v.newPassword.$invalid||e.loading,type:"submit",size:"sm",variant:"primary"}},[e._v("Submit")]),e._v(" "),r("small",{staticClass:"ml-2 text-warning"},[e._v("Your current sessions will expire.")])],1)],2)],1)],1),e._v(" "),r("b-row",{staticClass:"mb-4"},[r("b-col",[r("b-card",{staticClass:"shadow"},[r("template",{slot:"header"},[r("h5",{staticClass:"m-0"},[e._v("Keypairs")])]),e._v(" "),r("b-table",{ref:"keypairsTable",attrs:{responsive:"",hover:"","show-empty":"",items:e.keypairsTableItemsProvider,fields:e.keypairsTable.fields,"sort-by":e.keypairsTable.sortBy,"sort-desc":!1,"tbody-tr-class":"clickable-tr"},on:{"update:sortBy":function(t){return e.$set(e.keypairsTable,"sortBy",t)},"update:sort-by":function(t){return e.$set(e.keypairsTable,"sortBy",t)}},scopedSlots:e._u([{key:"type",fn:function(t){return[r("code",[e._v(e._s(t.item.type))])]}},{key:"valid",fn:function(e){return[e.item.valid?r("font-awesome-icon",{attrs:{icon:["fas","check"]}}):r("font-awesome-icon",{attrs:{icon:["fas","times"]}})]}},{key:"pubKey",fn:function(t){return[r("code",[e._v(e._s(t.item.pub_key))])]}},{key:"revCert",fn:function(t){return[r("code",[e._v(e._s(t.item.rev_cert))])]}},{key:"encPrivKey",fn:function(t){return[r("code",[e._v(e._s(t.item.enc_priv_key))])]}},{key:"salt",fn:function(t){return[r("code",[e._v(e._s(t.item.salt))])]}},{key:"created",fn:function(t){return[e._v("\n                        "+e._s(e._f("moment")(new Date(t.item.created).toISOString(),"YYYY.MM.DD"))+"\n                    ")]}},{key:"options",fn:function(t){return[e._v("\n                        -\n                    ")]}}])},[e._v(" "),e._v(" "),e._v(" "),e._v(" "),e._v(" "),e._v(" "),e._v(" "),e._v(" "),r("div",{staticClass:"text-center text-info my-2",attrs:{slot:"table-busy"},slot:"table-busy"},[r("strong",[e._v("Loading…")])])])],2)],1)],1),e._v(" "),r("b-modal",{ref:"checkMailModal",attrs:{"hide-footer":"",title:"Go check your mail!",lazy:""}},[r("div",{staticClass:"d-block text-center"},[r("h1",[e._v("✉️")]),e._v(" "),r("h5",[e._v("You should receive an email at the address "+e._s(e.newEmail)+" within few minutes.")]),e._v(" "),r("h5",[e._v("Please go check for it and confirm your address!")])])])],1)},n=[];a._withStripped=!0,r.d(t,"a",function(){return a}),r.d(t,"b",function(){return n})},knDc:function(e,t,r){"use strict";var a=function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{attrs:{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",width:this.width,viewBox:"0 0 210 200"}},[t("title",[this._v("flag")]),t("rect",{attrs:{width:"10",height:"200"}}),t("rect",{staticStyle:{fill:"none"},attrs:{x:"10",width:"200",height:"100"}}),t("path",{staticStyle:{fill:"#fff"},attrs:{d:"M210,100H10V0H210ZM14,96H206V4H14Z"}}),t("rect",{attrs:{id:"Quarter-1",x:"14",y:"4",width:"96",height:"46",fill:this.quarters[0]}}),t("rect",{attrs:{id:"Quarter-2",x:"110",y:"4",width:"96",height:"46",fill:this.quarters[1]}}),t("rect",{attrs:{id:"Quarter-3",x:"14",y:"50",width:"96",height:"46",fill:this.quarters[2]}}),t("rect",{attrs:{id:"Quarter-4",x:"110",y:"50",width:"96",height:"46",fill:this.quarters[3]}})])},n=[];a._withStripped=!0,r.d(t,"a",function(){return a}),r.d(t,"b",function(){return n})},oqNT:function(e,t,r){"use strict";r.r(t);var a=r("iNYP"),n=r("1gsz");for(var s in n)"default"!==s&&function(e){r.d(t,e,function(){return n[e]})}(s);r("aGq8");var i=r("KHd+"),o=Object(i.a)(n.default,a.a,a.b,!1,null,"6c92c824",null);o.options.__file="src/views/Users/Settings.vue",t.default=o.exports},sDcr:function(e,t,r){"use strict";r.r(t);var a=r("YeLY"),n=r.n(a);for(var s in a)"default"!==s&&function(e){r.d(t,e,function(){return a[e]})}(s);t.default=n.a}}]);